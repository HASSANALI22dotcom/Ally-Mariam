            <!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üè° Ukoo wa ALLY NDOILE MKILINDI</title>

<!-- Manifest + Icons -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#166534">
<link rel="icon" href="assets/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="assets/apple-touch-icon.png">

<style>
body { font-family:'Georgia', serif; background:#f3f4f6; color:#1f2937; margin:0; padding:0; }
.container { max-width:1200px; margin:auto; padding:20px; }
h1,h2 { text-align:center; }
form { background:white; padding:20px; border-radius:10px; box-shadow:0 3px 6px rgba(0,0,0,0.1); margin-bottom:30px; }
form input, form select, form button { padding:10px; margin:5px 0; width:100%; border-radius:6px; border:1px solid #d1d5db; }
form button { background:#166534; color:white; cursor:pointer; border:none; transition:0.3s; }
form button:hover { background:#1e40af; }
#tree-container { text-align:center; margin-bottom:30px; }
.tree-node { background:#f3f4f6; border:2px solid #166534; border-radius:10px; padding:10px 15px; min-width:140px; text-align:center; position:relative; margin:auto; }
.tree-node .avatar { width:40px; height:40px; border-radius:50%; background:linear-gradient(45deg,#166534,#1e40af); color:white; display:flex; align-items:center; justify-content:center; margin:0 auto 5px; font-weight:bold; object-fit:cover; }
.tree-children { display:flex; justify-content:center; gap:20px; margin-top:15px; flex-wrap:wrap; }
.stats { display:flex; justify-content:center; gap:20px; margin-top:20px; }
.stat-card { background:white; padding:15px; border-radius:10px; text-align:center; box-shadow:0 3px 6px rgba(0,0,0,0.1); min-width:100px; }
#communication { background:white; padding:20px; border-radius:10px; box-shadow:0 3px 6px rgba(0,0,0,0.1); margin-top:30px; }
#messages { border:1px solid #ccc; padding:10px; height:150px; overflow-y:auto; background:white; margin-bottom:10px; }
</style>
</head>
<body>
<div class="container">
<h1>üè° Ukoo wa ALLY NDOILE MKILINDI</h1>

<!-- Registration Form -->
<form id="signup-form">
<h2>üìù Jiandikishe Mwanaukoo</h2>
<input type="text" id="name" placeholder="Jina Kamili" required>
<input type="text" id="spouse" placeholder="Jina la Mume/Mke (optional)">
<select id="role" required>
<option value="">Chagua Nafasi</option>
<option value="Baba">Baba</option>
<option value="Mama">Mama</option>
<option value="Mtoto">Mtoto</option>
</select>
<select id="parent" required>
<option value="">Chagua mzazi / parent</option>
</select>
<input type="file" id="photo" accept="image/*">
<button type="submit">‚ûï Ongeza Mwanaukoo</button>
</form>

<!-- Stats -->
<div class="stats">
<div class="stat-card"><span id="total-members">0</span><br>Wanafamilia</div>
<div class="stat-card"><span id="total-grandchildren">0</span><br>Wajukuu</div>
</div>

<!-- Family Tree -->
<section id="tree">
<h2>üå≥ Mti wa Familia</h2>
<div id="tree-container"></div>
</section>

<!-- Communication -->
<section id="communication">
<h2>üì± Mawasiliano</h2>
<div id="messages"></div>
<input type="text" id="msgInput" placeholder="Andika ujumbe..." style="width:80%; padding:10px;">
<button id="sendMsgBtn" style="padding:10px;">Tuma</button>
<button onclick="alert('Call feature bado haijashikilia backend!')">Piga Simu</button>
</section>
</div>

<script>
// Initial family tree
let familyTree = {
id:1,
name:"ALLY NDOILE MKILINDI",
role:"Mzazi Mkuu",
spouse:"JANE MKILINDI",
children:[]
};

// Recursive tree render
function renderTree(person){
  const node=document.createElement('div');
  node.classList.add('tree-node');
  const avatarHTML = person.photo
    ? `<img src="${person.photo}" alt="${person.name}" class="avatar">`
    : `<div class="avatar">${person.name[0]}</div>`;
  node.innerHTML = `
    ${avatarHTML}
    <strong>${person.name}</strong><br>
    <small>${person.role}</small>
    ${person.spouse ? `<br><small>Ameolewa/Ameoa: ${person.spouse}</small>` : ''}
    ${person.children && person.children.length ? `<div class="tree-children"></div>` : ''}
  `;
  if(person.children && person.children.length){
    const childrenContainer=node.querySelector('.tree-children');
    person.children.forEach(child => { childrenContainer.appendChild(renderTree(child)); });
  }
  return node;
}

// Find parent
function findParent(node,id){
  if(node.id==id) return node;
  if(node.children) for(let c of node.children){ const res=findParent(c,id); if(res) return res; }
  return null;
}

// Update parent dropdown
function updateParentOptions(){
  const parentSelect=document.getElementById('parent');
  parentSelect.innerHTML='<option value="">Chagua mzazi / parent</option>';
  function addOptions(node,prefix=''){
    parentSelect.innerHTML+=`<option value="${node.id}">${prefix}${node.name} (${node.role})</option>`;
    if(node.children) node.children.forEach(c=>addOptions(c,prefix+'--'));
  }
  addOptions(familyTree);
}

// Stats
function updateStats(){
  document.getElementById('total-members').innerText=countMembers(familyTree);
  document.getElementById('total-grandchildren').innerText=countGrandchildren(familyTree);
}
function countMembers(node){let count=1;if(node.children)node.children.forEach(c=>count+=countMembers(c));return count;}
function countGrandchildren(node){let count=0;if(node.children){node.children.forEach(c=>{count+=c.children?c.children.length:0;count+=countGrandchildren(c);});}return count;}

// Add new member
document.getElementById('signup-form').addEventListener('submit',function(e){
  e.preventDefault();
  const name=document.getElementById('name').value.trim();
  const spouse=document.getElementById('spouse').value.trim();
  const role=document.getElementById('role').value;
  const parentId=parseInt(document.getElementById('parent').value);
  const photoFile=document.getElementById('photo').files[0];
  const photoURL = photoFile ? URL.createObjectURL(photoFile) : null;
  if(!name || !role || !parentId) return alert('Jaza taarifa zote');
  const parentNode=findParent(familyTree,parentId);
  const newId=Date.now();
  parentNode.children.push({id:newId,name,role,spouse,photo:photoURL,children:[]});
  document.getElementById('tree-container').innerHTML='';
  document.getElementById('tree-container').appendChild(renderTree(familyTree));
  updateParentOptions();
  updateStats();
  this.reset();
});

// Initial render
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('tree-container').appendChild(renderTree(familyTree));
  updateParentOptions();
  updateStats();

  // Load chat messages
  const messagesDiv=document.getElementById('messages');
  const msgs=JSON.parse(localStorage.getItem('messages')||"[]");
  msgs.forEach(msg=>{
    const div=document.createElement('div');
    div.style.padding="5px"; div.style.marginBottom="5px"; div.style.background="#e5e7eb"; div.style.borderRadius="5px";
    div.textContent="You: "+msg;
    messagesDiv.appendChild(div);
  });
});

// Chat functionality
document.getElementById('sendMsgBtn').addEventListener('click',()=>{
  const msgInput=document.getElementById('msgInput');
  const msg=msgInput.value.trim();
  if(!msg) return;
  const messagesDiv=document.getElementById('messages');
  const div=document.createElement('div');
  div.style.padding="5px"; div.style.marginBottom="5px"; div.style.background="#e5e7eb"; div.style.borderRadius="5px";
  div.textContent="You: "+msg;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
  let msgs=JSON.parse(localStorage.getItem('messages')||"[]");
  msgs.push(msg);
  localStorage.setItem('messages',JSON.stringify(msgs));
  msgInput.value="";
});
</script>

<!-- Service Worker -->
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
    .then(()=>console.log('‚úÖ Service Worker Registered'))
    .catch(err=>console.error('‚ùå SW registration failed:',err));
}
</script>
</body>
</html>
